{
  "info": {
    "name": "WNC Auction - Part 6 (System & Auto Bid - Split URLs)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Setup Tokens (NestJS)",
      "item": [
        {
          "name": "Login Seller",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"token_seller\", jsonData.access_token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"seller@gmail.com\", \"password\": \"123456\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        },
        {
          "name": "Login Bidder 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"token_1\", jsonData.access_token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"bidder1@gmail.com\", \"password\": \"123456\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        },
        {
          "name": "Login Bidder 2",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"token_2\", jsonData.access_token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"bidder2@gmail.com\", \"password\": \"123456\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        },
        {
          "name": "Login Bidder 3",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"token_3\", jsonData.access_token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"bidder3@gmail.com\", \"password\": \"123456\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        },
        {
          "name": "Login Bidder 4",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"token_4\", jsonData.access_token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"bidder4@gmail.com\", \"password\": \"123456\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "2. Scenario Setup (NestJS)",
      "item": [
        {
          "name": "Create iPhone 11 Auction",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"product_id\", jsonData.id);",
                  "console.log(\"Created Product ID: \" + jsonData.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_seller}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"iPhone 11 (Auto Bid Test)\",\n  \"category_id\": 1,\n  \"start_price\": 10000000,\n  \"step_price\": 100000,\n  \"description\": \"Test Auto Bidding logic\",\n  \"end_time\": \"2025-12-30T10:00:00.000Z\",\n  \"is_auto_extend\": true,\n  \"images\": [\"url1\", \"url2\", \"url3\"]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/products",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "products"
              ]
            },
            "description": "Gọi sang NestJS (Port 3000)"
          }
        }
      ]
    },
    {
      "name": "3. Auto Bidding (Java Spring Boot)",
      "item": [
        {
          "name": "Step 1: Bidder #1 (Max 11M)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Price should be 10,000,000\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    // Nếu Java Service trả về Product, check field currentPrice",
                  "    // Nếu trả về void/message thì check status 200",
                  "    if(jsonData.current_price) pm.expect(jsonData.current_price).to.eql(10000000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_1}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"productId\": {{product_id}},\n    \"amount\": 10000000, \n    \"isAutoBid\": true,\n    \"maxAmount\": 11000000\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{spring_url}}/bids",
              "host": [
                "{{spring_url}}"
              ],
              "path": [
                "bids"
              ]
            },
            "description": "Gọi sang Java Core (Port 8080). Giả sử endpoint là POST /bids"
          }
        },
        {
          "name": "Step 2: Bidder #2 (Max 10.8M)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Check Status 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_2}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"productId\": {{product_id}},\n    \"amount\": 10100000, \n    \"isAutoBid\": true,\n    \"maxAmount\": 10800000\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{spring_url}}/bids",
              "host": [
                "{{spring_url}}"
              ],
              "path": [
                "bids"
              ]
            }
          }
        },
        {
          "name": "Step 3: Bidder #3 (Max 11.5M)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Check Status 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_3}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"productId\": {{product_id}},\n    \"amount\": 10900000, \n    \"isAutoBid\": true,\n    \"maxAmount\": 11500000\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{spring_url}}/bids",
              "host": [
                "{{spring_url}}"
              ],
              "path": [
                "bids"
              ]
            }
          }
        },
        {
          "name": "Step 4: Bidder #4 (Max 11.5M)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Check Status 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_4}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"productId\": {{product_id}},\n    \"amount\": 11200000, \n    \"isAutoBid\": true,\n    \"maxAmount\": 11500000\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{spring_url}}/bids",
              "host": [
                "{{spring_url}}"
              ],
              "path": [
                "bids"
              ]
            }
          }
        },
        {
          "name": "Step 5: Bidder #4 (Max 11.7M)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Check Status 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_4}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"productId\": {{product_id}},\n    \"amount\": 11600000, \n    \"isAutoBid\": true,\n    \"maxAmount\": 11700000\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{spring_url}}/bids",
              "host": [
                "{{spring_url}}"
              ],
              "path": [
                "bids"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "4. Mailing Triggers (NestJS)",
      "item": [
        {
          "name": "Buyer asks question",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_1}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"content\": \"Máy này pin còn bao nhiêu %?\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/products/{{product_id}}/questions",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "products",
                "{{product_id}}",
                "questions"
              ]
            },
            "description": "NestJS (Port 3000)"
          },
          "response": []
        },
        {
          "name": "Seller answers question",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token_seller}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"answer\": \"Pin còn 90% bạn nhé.\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/products/questions/1/answer",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "products",
                "questions",
                "1",
                "answer"
              ]
            },
            "description": "NestJS (Port 3000). Lưu ý ID câu hỏi"
          },
          "response": []
        }
      ]
    }
  ]
}